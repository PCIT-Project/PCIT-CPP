def std = @import("std");


type Package = struct #pub {
	func new = (path: [Char:*], name: [Char:*], warnings: @build.PackageWarningSettings in) #rt
	-> (output: This) {
		output.package_id = @buildCreatePackage(path, name, forward warnings);
		return...;
	}

	// func new = (warning_settings: @build.PackageWarningSettings in, path: [Char:$$;'\0']*) #rt -> (output: This) {
	// 	output = new Package(forward warning_settings, path.* as [Char:*]);
	// 	return...;
	// }



	func addSourceFile = (this, path: [Char:*]) #rt -> Void {
		@buildAddSourceFile(path, this.package_id);
	}

	func addSourceFile = (this, path: [Char:$$;'\0']*) #rt -> Void {
		this.addSourceFile(path.* as [Char:*]);
	}



	func addSourceDirectory = (this, path: [Char:*], is_recursive: Bool) #rt -> Void {
		@buildAddSourceDirectory(path, this.package_id, is_recursive);
	}

	func addSourceDirectory = (this, path: [Char:$$;'\0']*, is_recursive: Bool) #rt -> Void {
		this.addSourceDirectory(path.* as [Char:*], is_recursive);
	}


	
	const package_id: @build.PackageID;
}


func setOutput = (output: std.build.Output) #pub #rt -> Void {
	@buildSetOutput(output as UI32);
}

func setNumThreads = (num_threads: UI32) #pub #rt -> Void {
	@buildSetNumThreads(num_threads);
}


func setStdLibPackage = (package: Package) #pub #rt -> Void {
	@buildSetStdLibPackage(package.package_id);
}


func addStdLib = (path: [Char:*]) #pub #rt -> Void {
	const warns = new @build.PackageWarningSettings{
		methodCallOnNonMethod        = true,
		deleteMovedFromExpr          = true,
		deleteTriviallyDeletableType = true,
		constexprIfCond              = true,
	};

	const std_lib_package = new Package(path, "std".* as [Char:*], copy warns);
	std_lib_package.addSourceDirectory("./", true);
	setStdLibPackage(std_lib_package);
}


func addStdLib = (path: [Char:$$;'\0']*) #pub #rt -> Void {
	addStdLib(path.* as [Char:*]);
}